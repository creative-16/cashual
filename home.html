<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" rel="stylesheet">
    <style>
        :root {
            --primary: #6366F1;
            --primary-dark: #4F46E5;
            --secondary: #10B981;
            --danger: #EF4444;
            --warning: #F59E0B;
            --info: #3B82F6;
            --dark: #1F2937;
            --light: #F9FAFB;
            --gray: #6B7280;
            --purple: #8B5CF6;
            --pink: #EC4899;
            --pastel-blue: #E0E7FF;
            --pastel-green: #D1FAE5;
            --pastel-red: #FEE2E2;
            --pastel-yellow: #FEF3C7;
            --pastel-purple: #EDE9FE;
            --pastel-pink: #FCE7F3;
            --pastel-gray: #F3F4F6;
            --indian-saffron: #FF9933;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--dark);
        }

        .main-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            padding: 24px;
            margin-bottom: 24px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }

        .glass-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
        }

        .pastel-card {
            background: var(--pastel-gray);
            border-radius: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            padding: 24px;
            margin-bottom: 24px;
            border: 1px solid rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }

        .pastel-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
        }

        .btn {
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 14px;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(99, 102, 241, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--secondary) 0%, #059669 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger) 0%, #DC2626 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(239, 68, 68, 0.4);
        }

        .btn-outline {
            background: var(--pastel-gray);
            border: 2px solid var(--gray);
            color: var(--dark);
        }

        .btn-outline:hover {
            background: var(--pastel-blue);
            border-color: var(--primary);
            color: var(--primary);
            transform: translateY(-2px);
        }

        .nav-container {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(10px);
            border-radius: 0 0 20px 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            padding: 16px 24px;
            margin-bottom: 24px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            position: relative;
            z-index: 10;
        }

        .nav-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .nav-btn i {
            font-size: 28px;
            transition: all 0.3s ease;
        }

        .nav-btn.home {
            background-color: var(--primary);
        }

        .nav-btn.home i {
            color: white;
        }

        .nav-btn.home:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(99, 102, 241, 0.4);
        }

        .nav-btn.overview {
            background-color: var(--info);
        }

        .nav-btn.overview i {
            color: white;
        }

        .nav-btn.overview:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
        }

        .nav-btn.accounts {
            background-color: var(--secondary);
        }

        .nav-btn.accounts i {
            color: white;
        }

        .nav-btn.accounts:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
        }

        .nav-btn.budget {
            background-color: var(--warning);
        }

        .nav-btn.budget i {
            color: white;
        }

        .nav-btn.budget:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(245, 158, 11, 0.4);
        }

        .nav-btn.settings {
            background-color: var(--gray);
        }

        .nav-btn.settings i {
            color: white;
        }

        .nav-btn.settings:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(107, 114, 128, 0.4);
        }

        .nav-btn.profile {
            background-color: var(--purple);
        }

        .nav-btn.profile i {
            color: white;
        }

        .nav-btn.profile:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(139, 92, 246, 0.4);
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 16px;
            padding: 20px;
            color: white;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
        }

        .stat-card.income {
            background: linear-gradient(135deg, var(--secondary) 0%, #059669 100%);
        }

        .stat-card.expense {
            background: linear-gradient(135deg, var(--danger) 0%, #DC2626 100%);
        }

        .stat-card.monthly {
            background: linear-gradient(135deg, var(--indian-saffron) 0%, #FF7E5F 100%);
        }

        .account-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 16px;
            padding: 20px;
            color: white;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
            height: 100%;
        }

        .account-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .account-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
        }

        .account-carousel {
            position: relative;
            overflow: hidden;
            height: 100%;
        }

        .account-carousel-inner {
            display: flex;
            transition: transform 0.5s ease;
            height: 100%;
        }

        .account-slide {
            min-width: 100%;
            position: relative;
        }

        .account-controls {
            position: absolute;
            bottom: 10px;
            right: 10px;
            display: flex;
            gap: 5px;
            z-index: 10;
        }

        .account-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.5);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .account-dot.active {
            background: white;
            transform: scale(1.2);
        }

        .account-nav-button {
            position: absolute;
            top: 50%;
            right: 10px;
            transform: translateY(-50%);
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            border: none;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            z-index: 10;
            display: none;
        }

        @media (min-width: 768px) {
            .account-nav-button {
                display: flex;
            }
        }

        .account-nav-button:hover {
            background: rgba(255, 255, 255, 0.5);
        }

        .tag {
            display: inline-flex;
            align-items: center;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
            margin: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .tag:hover {
            transform: scale(1.05);
        }

        .transaction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            margin-bottom: 12px;
            background: var(--pastel-gray);
            border-radius: 12px;
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
            position: relative;
            overflow: hidden;
        }

        .transaction-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .transaction-item:hover::before {
            left: 100%;
        }

        .transaction-item:hover {
            transform: translateX(4px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        .transaction-item.income {
            border-left-color: var(--secondary);
            background: var(--pastel-green);
        }

        .transaction-item.expense {
            border-left-color: var(--danger);
            background: var(--pastel-red);
        }

        .calendar-day {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .calendar-day:hover {
            background: var(--pastel-blue);
            transform: scale(1.1);
        }

        .calendar-day.active {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
            transform: scale(1.1);
        }

        .calendar-day.has-transactions {
            position: relative;
        }

        .calendar-day.has-transactions::after {
            content: '';
            position: absolute;
            bottom: 2px;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--secondary);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
        }

        .modal.active {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .modal-content {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            padding: 32px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        @keyframes slideUp {
            from {
                transform: translateY(50px);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-content.income {
            background: linear-gradient(135deg, var(--pastel-green) 0%, #d1fae5 100%);
        }

        .modal-content.expense {
            background: linear-gradient(135deg, var(--pastel-red) 0%, #fee2e2 100%);
        }

        .input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #E5E7EB;
            border-radius: 12px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: white;
        }

        .input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
            transform: translateY(-2px);
        }

        .select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #E5E7EB;
            border-radius: 12px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: white;
            cursor: pointer;
        }

        .select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
            transform: translateY(-2px);
        }

        .chart-container {
            height: 300px;
            position: relative;
        }

        .pie-chart-container {
            height: 250px;
            position: relative;
        }

        .progress-bar {
            height: 10px;
            background: #E5E7EB;
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--secondary) 0%, #059669 100%);
            transition: width 0.5s ease;
            border-radius: 10px;
        }

        .progress-fill.warning {
            background: linear-gradient(90deg, var(--warning) 0%, #D97706 100%);
        }

        .progress-fill.danger {
            background: linear-gradient(90deg, var(--danger) 0%, #DC2626 100%);
        }

        .notification {
            position: fixed;
            bottom: 20px;
            left: 20px;
            padding: 16px 24px;
            border-radius: 12px;
            background: white;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            z-index: 2000;
            display: flex;
            align-items: center;
            gap: 12px;
            transform: translateY(400px);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateY(0);
            animation: slideInUp 0.3s ease;
        }

        @keyframes slideInUp {
            from {
                transform: translateY(100%);
            }

            to {
                transform: translateY(0);
            }
        }

        .notification.success {
            border-left: 4px solid var(--secondary);
        }

        .notification.error {
            border-left: 4px solid var(--danger);
        }

        .notification.info {
            border-left: 4px solid var(--info);
        }

        .loader {
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
            border-radius: 8px;
        }

        @keyframes loading {
            0% {
                background-position: 200% 0;
            }

            100% {
                background-position: -200% 0;
            }
        }

        .quick-add-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 16px;
            padding: 24px;
            color: white;
        }

        .quick-add-section .input,
        .quick-add-section .select {
            background: rgba(255, 255, 255, 0.9);
            border: none;
            color: var(--dark);
        }

        .quick-add-section .input:focus,
        .quick-add-section .select:focus {
            background: white;
        }

        .toggle-container {
            display: flex;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 4px;
        }

        .toggle-btn {
            flex: 1;
            padding: 10px;
            border-radius: 8px;
            background: transparent;
            border: none;
            color: rgba(255, 255, 255, 0.7);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .toggle-btn.active {
            background: white;
            color: var(--primary);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transform: scale(1.05);
        }

        .calendar-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border-radius: 16px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            padding: 20px;
            margin-top: 8px;
            transform: translateY(-10px);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            min-width: 300px;
            max-height: 400px;
            overflow-y: auto;
            pointer-events: none;
            /* Disable pointer events when hidden */
        }

        .calendar-dropdown.active {
            transform: translateY(0);
            opacity: 1;
            visibility: visible;
            pointer-events: auto;
            /* Enable pointer events when visible */
        }

        /* Calendar close button */
        .calendar-close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: rgba(239, 68, 68, 0.1);
            border: none;
            color: var(--danger);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            z-index: 10;
        }

        .calendar-close-btn:hover {
            background: var(--danger);
            color: white;
            transform: scale(1.1);
        }

        /* Force flatpickr to always show desktop version */
        .calendar-dropdown .flatpickr-calendar {
            width: 100% !important;
            max-width: 300px !important;
            box-shadow: none !important;
            border: none !important;
            background: transparent !important;
            position: static !important;
            top: auto !important;
            left: auto !important;
            right: auto !important;
            bottom: auto !important;
            transform: none !important;
        }

        .calendar-dropdown .flatpickr-calendar.inline {
            width: 100% !important;
            max-width: 300px !important;
            box-shadow: none !important;
            border: none !important;
            background: transparent !important;
            position: static !important;
            top: auto !important;
            left: auto !important;
            right: auto !important;
            bottom: auto !important;
            transform: none !important;
            margin-bottom: 0 !important;
        }

        .calendar-dropdown .flatpickr-months {
            margin: 0 0 10px 0 !important;
            padding: 0 !important;
        }

        .calendar-dropdown .flatpickr-month {
            height: auto !important;
            fill: #667eea !important;
        }

        .calendar-dropdown .flatpickr-current-month {
            color: #667eea !important;
            font-weight: 600 !important;
            padding: 5px 0 0 0 !important;
        }

        .calendar-dropdown .flatpickr-months .flatpickr-prev-month,
        .calendar-dropdown .flatpickr-months .flatpickr-next-month {
            fill: #667eea !important;
            padding: 10px !important;
        }

        .calendar-dropdown .flatpickr-months .flatpickr-prev-month:hover,
        .calendar-dropdown .flatpickr-months .flatpickr-next-month:hover {
            fill: #4F46E5 !important;
        }

        .calendar-dropdown .flatpickr-weekdays {
            margin: 0 0 5px 0 !important;
        }

        .calendar-dropdown .flatpickr-weekday {
            color: #667eea !important;
            font-weight: 600 !important;
        }

        .calendar-dropdown .flatpickr-days {
            width: 100% !important;
            padding: 0 !important;
        }

        .calendar-dropdown .dayContainer {
            width: 100% !important;
            min-width: 100% !important;
            max-width: 100% !important;
            padding: 0 !important;
        }

        .calendar-dropdown .flatpickr-day {
            width: calc(14.28% - 2px) !important;
            height: 32px !important;
            line-height: 32px !important;
            margin: 1px !important;
            font-size: 14px !important;
            border-radius: 8px !important;
        }

        .calendar-dropdown .flatpickr-day:hover {
            background: #E0E7FF !important;
            color: #667eea !important;
        }

        .calendar-dropdown .flatpickr-day.selected {
            background: #667eea !important;
            color: white !important;
            border-color: #667eea !important;
        }

        .calendar-dropdown .flatpickr-day.today {
            border-color: #667eea !important;
        }

        .calendar-dropdown .flatpickr-day.today:hover {
            background: #667eea !important;
            color: white !important;
        }

        .calendar-dropdown .flatpickr-day.prevMonthDay,
        .calendar-dropdown .flatpickr-day.nextMonthDay {
            color: #ccc !important;
        }

        .icon-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--pastel-gray);
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .icon-btn:hover {
            transform: scale(1.1);
            background: var(--pastel-blue);
        }

        .icon-btn.active {
            background: var(--primary);
            color: white;
        }

        .pie-chart-box {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            border: 1px solid rgba(0, 0, 0, 0.05);
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .profile-dropdown {
            position: relative;
        }

        .profile-menu {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            padding: 10px;
            margin-top: 8px;
            min-width: 200px;
            display: none;
            opacity: 0;
            transform: translateY(-10px);
            transition: all 0.3s ease;
        }

        .profile-menu.active {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }

        .profile-menu-item {
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .profile-menu-item:hover {
            background: var(--pastel-gray);
        }

        .transactions-container {
            height: 400px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .transactions-container::-webkit-scrollbar {
            width: 6px;
        }

        .transactions-container::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        .transactions-container::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }

        .transactions-container::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        .equal-height-container {
            display: flex;
            flex-direction: column;
            height: 450px;
        }

        .equal-height-row {
            display: flex;
            flex: 1;
            height: 100%;
        }

        .equal-height-col {
            flex: 1;
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .mobile-menu {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .mobile-menu.active {
            opacity: 1;
            visibility: visible;
        }

        .mobile-menu-content {
            position: absolute;
            top: 0;
            left: 0;
            width: 80%;
            max-width: 300px;
            height: 100%;
            background: white;
            padding: 20px;
            transform: translateX(-100%);
            transition: transform 0.3s ease;
        }

        .mobile-menu.active .mobile-menu-content {
            transform: translateX(0);
        }

        .mobile-menu-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .mobile-menu-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
        }

        .mobile-menu-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .mobile-menu-item:hover {
            background: var(--pastel-gray);
        }

        .mobile-menu-item i {
            font-size: 20px;
        }

        .mobile-menu-item.home {
            color: var(--primary);
        }

        .mobile-menu-item.overview {
            color: var(--info);
        }

        .mobile-menu-item.accounts {
            color: var(--secondary);
        }

        .mobile-menu-item.budget {
            color: var(--warning);
        }

        .mobile-menu-item.settings {
            color: var(--gray);
        }

        .mobile-menu-item.profile {
            color: var(--purple);
        }

        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
            border-radius: 20px;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(99, 102, 241, 0.2);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .section-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--dark);
        }

        .section-subtitle {
            font-size: 0.875rem;
            color: var(--gray);
            margin-top: 4px;
        }

        .button-group {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        /* Delete Confirmation Modal */
        .delete-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
        }

        .delete-modal.active {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        .delete-modal-content {
            background: white;
            border-radius: 20px;
            width: 90%;
            max-width: 400px;
            padding: 32px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s ease;
            text-align: center;
        }

        .delete-modal-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: rgba(239, 68, 68, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
        }

        .delete-modal-icon i {
            font-size: 30px;
            color: var(--danger);
        }

        .delete-modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--dark);
        }

        .delete-modal-message {
            color: var(--gray);
            margin-bottom: 24px;
        }

        .delete-modal-buttons {
            display: flex;
            gap: 12px;
        }

        /* Notification Section */
        .notification-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 16px;
            padding: 24px;
            color: white;
            margin-bottom: 24px;
        }

        .notification-tabs {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
            overflow-x: auto;
            padding-bottom: 8px;
        }

        .notification-tab {
            padding: 10px 16px;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            position: relative;
            white-space: nowrap;
        }

        .notification-tab:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .notification-tab.active {
            background: white;
            color: var(--primary);
        }

        .notification-tab.has-notifications {
            background: var(--warning);
            color: white;
        }

        .notification-tab.has-notifications.active {
            background: white;
            color: var(--primary);
        }

        .notification-content {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 12px;
            padding: 16px;
            color: var(--dark);
            height: 200px;
            overflow-y: auto;
        }

        .notification-item {
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 8px;
            background: var(--pastel-gray);
            transition: all 0.3s ease;
            animation: fadeIn 0.5s ease;
            position: relative;
        }

        .notification-item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        .notification-item-title {
            font-weight: 600;
            margin-bottom: 4px;
            padding-right: 30px;
        }

        .notification-item-message {
            font-size: 14px;
            color: var(--gray);
            padding-right: 30px;
        }

        .notification-item-time {
            font-size: 12px;
            color: var(--gray);
            margin-top: 4px;
        }

        .notification-item-close {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: rgba(239, 68, 68, 0.1);
            border: none;
            color: var(--danger);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .notification-item-close:hover {
            background: var(--danger);
            color: white;
        }

        .empty-notification {
            text-align: center;
            padding: 20px;
            color: var(--gray);
        }

        /* Category Legend Scroll for Desktop */
        @media (min-width: 1024px) {
            .category-legend-container {
                max-height: 120px;
                overflow-y: auto;
                padding-right: 10px;
                margin-top: 16px;
            }

            .category-legend-container::-webkit-scrollbar {
                width: 6px;
            }

            .category-legend-container::-webkit-scrollbar-track {
                background: #f1f1f1;
                border-radius: 10px;
            }

            .category-legend-container::-webkit-scrollbar-thumb {
                background: #888;
                border-radius: 10px;
            }

            .category-legend-container::-webkit-scrollbar-thumb:hover {
                background: #555;
            }
        }

        /* Calendar Dropdown Fix for Mobile */
        @media (max-width: 768px) {
            .calendar-dropdown {
                position: fixed !important;
                top: 50% !important;
                left: 50% !important;
                transform: translate(-50%, -50%) !important;
                width: 90% !important;
                max-width: 350px !important;
                max-height: 80vh !important;
                overflow-y: auto !important;
                margin-top: 0 !important;
                z-index: 9999 !important;
            }

            .calendar-dropdown.active {
                transform: translate(-50%, -50%) !important;
            }

            .calendar-dropdown .flatpickr-calendar {
                width: 100% !important;
                max-width: 350px !important;
            }

            .calendar-dropdown .flatpickr-calendar.inline {
                width: 100% !important;
                max-width: 350px !important;
            }

            .calendar-dropdown .flatpickr-day {
                width: calc(14.28% - 2px) !important;
                height: 36px !important;
                line-height: 36px !important;
                font-size: 16px !important;
            }
        }

        @media (max-width: 1024px) {
            .equal-height-row {
                flex-direction: column;
            }
        }

        @media (max-width: 768px) {
            .main-container {
                padding: 10px;
            }

            .glass-card,
            .pastel-card {
                padding: 16px;
            }

            .modal-content {
                width: 95%;
                padding: 20px;
            }

            .nav-btn {
                width: 50px;
                height: 50px;
            }

            .nav-btn i {
                font-size: 24px;
            }

            .transactions-container {
                height: 300px;
            }

            .equal-height-container {
                height: auto;
                min-height: 350px;
            }

            .mobile-menu {
                display: block;
            }

            .desktop-nav {
                display: none;
            }

            .section-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 12px;
            }

            .button-group {
                width: 100%;
                justify-content: space-between;
            }

            .btn {
                flex: 1;
                justify-content: center;
                min-width: 0;
            }

            .quick-add-section .grid {
                grid-template-columns: 1fr 1fr;
                gap: 12px;
            }

            .quick-add-section .toggle-container {
                grid-column: span 2;
            }

            .quick-add-section .btn {
                grid-column: span 2;
            }

            .equal-height-row {
                flex-direction: column;
                gap: 20px;
            }

            .equal-height-col {
                padding: 0 !important;
            }
        }

        @media (max-width: 480px) {
            .quick-add-section .grid {
                grid-template-columns: 1fr;
            }

            .quick-add-section .toggle-container {
                grid-column: span 1;
            }

            .quick-add-section .btn {
                grid-column: span 1;
            }
        }
    </style>
</head>

<body>
    <!-- Mobile Menu -->
    <div id="mobileMenu" class="mobile-menu">
        <div class="mobile-menu-content">
            <div class="mobile-menu-header">
                <h2 class="text-xl font-bold">Menu</h2>
                <button class="mobile-menu-close" onclick="toggleMobileMenu()">
                    <i class="ri-close-line"></i>
                </button>
            </div>
            <div class="mobile-menu-item home" onclick="navigateTo('home.html')">
                <i class="ri-home-4-line"></i>
                <span>Home</span>
            </div>
            <div class="mobile-menu-item overview" onclick="navigateTo('overview.html')">
                <i class="ri-dashboard-line"></i>
                <span>Overview</span>
            </div>
            <div class="mobile-menu-item accounts" onclick="navigateTo('accounts.html')">
                <i class="ri-wallet-line"></i>
                <span>Accounts</span>
            </div>
            <div class="mobile-menu-item budget" onclick="navigateTo('budget.html')">
                <i class="ri-pie-chart-line"></i>
                <span>Budget</span>
            </div>
            <div class="mobile-menu-item settings" onclick="navigateTo('settings.html')">
                <i class="ri-settings-3-line"></i>
                <span>Settings</span>
            </div>
            <div class="mobile-menu-item profile" onclick="navigateTo('profile.html')">
                <i class="ri-user-3-line"></i>
                <span>Profile</span>
            </div>
            <div class="mobile-menu-item" onclick="logout()">
                <i class="ri-logout-box-line"></i>
                <span>Logout</span>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="nav-container">
        <div class="flex justify-between items-center">
            <div class="flex items-center gap-3">
                <button class="md:hidden" onclick="toggleMobileMenu()">
                    <i class="ri-menu-line text-2xl text-gray-700"></i>
                </button>
                <div
                    class="w-12 h-12 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-xl flex items-center justify-center">
                    <i class="ri-wallet-3-line text-white text-xl"></i>
                </div>
                <div>
                    <h1
                        class="text-2xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent">
                        Cashual
                    </h1>
                    <p class="text-sm text-gray-600">Budget Planner</p>
                </div>
            </div>
            <div class="desktop-nav flex items-center gap-4">
                <button class="nav-btn home" onclick="navigateTo('home.html')" title="Home">
                    <i class="ri-home-4-line"></i>
                </button>
                <button class="nav-btn overview" onclick="navigateTo('overview.html')" title="Overview">
                    <i class="ri-dashboard-line"></i>
                </button>
                <button class="nav-btn accounts" onclick="navigateTo('accounts.html')" title="Accounts">
                    <i class="ri-wallet-line"></i>
                </button>
                <button class="nav-btn budget" onclick="navigateTo('budget.html')" title="Budget">
                    <i class="ri-pie-chart-line"></i>
                </button>
                <button class="nav-btn settings" onclick="navigateTo('settings.html')" title="Settings">
                    <i class="ri-settings-3-line"></i>
                </button>
                <div class="profile-dropdown">
                    <a href="profile.html"><button class="nav-btn profile" title="Profile"
                            onclick="toggleProfileMenu()">
                            <i class="ri-user-3-line"></i>
                        </button></a>
                    <div id="profileMenu" class="profile-menu">
                        <div class="profile-menu-item">
                            <i class="ri-user-line"></i>
                            <span id="profileUsername">Username</span>
                        </div>

                        <div class="profile-menu-item" onclick="logout()">
                            <i class="ri-logout-box-line"></i>
                            <span>Logout</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-container">
        <!-- Stats Overview - Updated with Account View -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
            <!-- Account View Card (replaces Current Balance) -->
            <div class="account-card">
                <div class="account-carousel">
                    <div class="account-carousel-inner" id="accountCarousel">
                        <!-- Account slides will be dynamically added here -->
                    </div>
                    <button class="account-nav-button" id="nextAccountBtn">
                        <i class="ri-arrow-right-s-line"></i>
                    </button>
                    <div class="account-controls" id="accountControls">
                        <!-- Account dots will be dynamically added here -->
                    </div>
                </div>
            </div>
            <div class="stat-card income">
                <div class="relative z-10">
                    <p class="text-white/80 text-sm mb-1" id="incomeLabel">Today's Income</p>
                    <p class="text-3xl font-bold" id="todayIncome">₹0.00</p>
                    <p class="text-white/60 text-xs mt-2">+0 transactions</p>
                </div>
            </div>
            <div class="stat-card expense">
                <div class="relative z-10">
                    <p class="text-white/80 text-sm mb-1" id="expenseLabel">Today's Expenses</p>
                    <p class="text-3xl font-bold" id="todayExpense">₹0.00</p>
                    <p class="text-white/60 text-xs mt-2">-0 transactions</p>
                </div>
            </div>
            <div class="stat-card monthly">
                <div class="relative z-10">
                    <p class="text-white/80 text-sm mb-1">Monthly Total</p>
                    <p class="text-3xl font-bold" id="monthlyTotal">₹0.00</p>
                    <p class="text-white/60 text-xs mt-2" id="currentMonth"></p>
                </div>
            </div>
        </div>

        <!-- Today's Transactions Section - Split into Two Parts with Equal Height -->
        <div class="equal-height-container mb-6">
            <div class="equal-height-row">
                <!-- Left Section - Transaction List -->
                <div class="equal-height-col pr-3">
                    <div class="glass-card h-full flex flex-col">
                        <div class="section-header">
                            <div>
                                <h3 class="section-title" id="transactionSectionTitle">Today's Transactions</h3>
                                <p class="section-subtitle" id="todayDate"></p>
                            </div>
                            <div class="button-group">
                                <button id="todayBtn" class="btn btn-outline">
                                    <i class="ri-calendar-today-line" style="color: black;">Today</i>
                                </button>
                                <div class="relative">
                                    <button id="datePickerBtn" class="btn btn-outline">
                                        <i class="ri-calendar-event-line"></i>
                                    </button>
                                    <div id="calendarDropdown" class="calendar-dropdown">
                                        <button class="calendar-close-btn" onclick="closeCalendar()">
                                            <i class="ri-close-line"></i>
                                        </button>
                                        <div id="inlineCalendar"></div>
                                    </div>
                                </div>
                                <button id="addTransactionBtn" class="btn btn-primary">
                                    <i class="ri-add-line"></i> Add
                                </button>
                            </div>
                        </div>

                        <div class="transactions-container flex-grow" id="todayTransactionsContainer">
                            <div id="todayTransactions">
                                <!-- Transactions will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right Section - Category Pie Chart -->
                <div class="equal-height-col pl-3">
                    <div class="pie-chart-box h-full">
                        <div class="section-header">
                            <h4 class="section-title flex items-center gap-2">
                                <i class="ri-pie-chart-2-line"></i>
                                Category Spending
                            </h4>
                        </div>
                        <div class="pie-chart-container">
                            <canvas id="categoryPieChart"></canvas>
                        </div>
                        <div id="categoryLegend" class="category-legend-container">
                            <!-- Category legend will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Add Section -->
        <div class="quick-add-section mb-6">
            <h2 class="text-xl font-bold mb-4">Quick Add Transaction</h2>
            <div class="grid grid-cols-1 md:grid-cols-7 gap-3">
                <input type="number" id="quickAmount" class="input" placeholder="Amount">
                <div class="toggle-container">
                    <button type="button" class="toggle-btn active" id="quickExpenseBtn">
                        <i class="ri-arrow-up-line"></i>
                    </button>
                    <button type="button" class="toggle-btn" id="quickIncomeBtn">
                        <i class="ri-arrow-down-line"></i>
                    </button>
                </div>
                <select id="quickTag" class="select">
                    <option value="">Select Tag</option>
                </select>
                <select id="quickAccount" class="select">
                    <option value="">Select Account</option>
                </select>
                <input type="text" id="quickDate" class="input" placeholder="Date">
                <input type="text" id="quickNote" class="input" placeholder="Note">
                <button id="quickAddBtn" class="btn btn-primary">
                    <i class="ri-add-line"></i>
                </button>
            </div>
        </div>

        <!-- Notification Section -->
        <div class="notification-section">
            <h2 class="text-xl font-bold mb-4">Notifications</h2>
            <div class="notification-tabs">
                <button class="notification-tab active" data-type="general" id="generalTab">
                    <i class="ri-notification-3-line"></i>
                    General
                </button>
                <button class="notification-tab" data-type="alert" id="alertTab">
                    <i class="ri-alert-line"></i>
                    Alerts
                </button>
                <button class="notification-tab" data-type="achieved" id="achievedTab">
                    <i class="ri-trophy-line"></i>
                    Achieved
                </button>
                <button class="notification-tab" data-type="suggestions" id="suggestionsTab">
                    <i class="ri-lightbulb-line"></i>
                    Suggestions
                </button>
            </div>
            <div class="notification-content" id="notificationContent">
                <div class="empty-notification">
                    <i class="ri-notification-off-line text-4xl mb-2"></i>
                    <p>No notifications yet</p>
                </div>
            </div>
        </div>

        <!-- Monthly Overview Section -->
        <div class="glass-card">
            <div class="section-header">
                <h3 class="section-title">Monthly Overview</h3>
                <div class="button-group">
                    <button id="exportBtn" class="btn btn-outline">
                        <i class="ri-download-line"></i> Export
                    </button>
                    <button id="backupBtn" class="btn btn-outline">
                        <i class="ri-refresh-line"></i> Backup
                    </button>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                <div class="bg-green-50 rounded-lg p-4 border border-green-200">
                    <p class="text-green-600 text-sm font-medium mb-1">Total Income</p>
                    <p class="text-2xl font-bold text-green-900" id="monthlyIncome">₹0.00</p>
                </div>
                <div class="bg-red-50 rounded-lg p-4 border border-red-200">
                    <p class="text-red-600 text-sm font-medium mb-1">Total Expenses</p>
                    <p class="text-2xl font-bold text-red-900" id="monthlyExpense">₹0.00</p>
                </div>
                <div class="bg-indigo-50 rounded-lg p-4 border border-indigo-200">
                    <p class="text-indigo-600 text-sm font-medium mb-1">Net</p>
                    <p class="text-2xl font-bold text-indigo-900" id="monthlyNet">₹0.00</p>
                </div>
            </div>

            <div class="chart-container mb-6">
                <canvas id="monthlyChart"></canvas>
            </div>

            <div>
                <h4 class="text-lg font-semibold mb-3">Monthly Transactions</h4>
                <div id="monthlyTransactions" class="space-y-2">
                    <!-- Monthly transactions will be loaded here -->
                </div>
            </div>
        </div>
    </main>

    <!-- Transaction Modal -->
    <div id="transactionModal" class="modal">
        <div class="modal-content expense">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold">Add Transaction</h3>
                <button id="closeTransactionModal" class="text-gray-500 hover:text-gray-700">
                    <i class="ri-close-line text-xl"></i>
                </button>
            </div>

            <form id="transactionForm" class="space-y-4">
                <div class="form-group">
                    <label class="form-label">Transaction Type</label>
                    <div class="toggle-container">
                        <button type="button" class="toggle-btn active" id="expenseTypeBtn">
                            <i class="ri-arrow-up-line"></i>
                            <p style="color: rgb(138, 28, 98);">Expense</p>
                        </button>
                        <button type="button" class="toggle-btn" id="incomeTypeBtn">
                            <i class="ri-arrow-down-line"></i>
                            <p style="color: rgb(20, 122, 150);">Income</p>
                        </button>
                    </div>
                    <input type="hidden" id="transactionType" value="expense">
                </div>

                <div class="form-group">
                    <label class="form-label">Amount</label>
                    <input type="number" id="transactionAmount" class="input" placeholder="0.00" step="0.01" required>
                </div>

                <div class="form-group">
                    <label class="form-label">Date</label>
                    <input type="text" id="transactionDate" class="input" required>
                </div>

                <div class="form-group">
                    <label class="form-label">Category</label>
                    <select id="transactionTag" class="select" required>
                        <option value="">Select Category</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Account</label>
                    <select id="transactionAccount" class="select" required>
                        <option value="">Select Account</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Note</label>
                    <input type="text" id="transactionNote" class="input" placeholder="Optional note">
                </div>

                <div class="flex gap-2">
                    <button type="submit" class="btn btn-primary flex-1">
                        <i class="ri-save-line"></i> Save Transaction
                    </button>
                    <button type="button" id="cancelTransaction" class="btn btn-outline flex-1">
                        <i class="ri-close-line"></i> Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteModal" class="delete-modal">
        <div class="delete-modal-content">
            <div class="delete-modal-icon">
                <i class="ri-delete-bin-line"></i>
            </div>
            <h3 class="delete-modal-title">Delete Transaction?</h3>
            <p class="delete-modal-message">Are you sure you want to delete this transaction? This action cannot be
                undone.</p>
            <div class="delete-modal-buttons">
                <button id="confirmDelete" class="btn btn-danger flex-1">
                    <i class="ri-delete-bin-line"></i> Delete
                </button>
                <button id="cancelDelete" class="btn btn-outline flex-1">
                    <i class="ri-close-line"></i> Cancel
                </button>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div id="notification" class="notification">
        <i id="notificationIcon" class="ri-check-line text-xl"></i>
        <div>
            <p id="notificationTitle" class="font-medium"></p>
            <p id="notificationMessage" class="text-sm text-gray-600"></p>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-storage-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyC3HbtBbtcGf8b54DzlLfatJ_Xfdum-yqA",
            authDomain: "budget-ce802.firebaseapp.com",
            databaseURL: "https://budget-ce802-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "budget-ce802",
            storageBucket: "budget-ce802.firebasestorage.app",
            messagingSenderId: "346208284823",
            appId: "1:346208284823:web:c580812cce390463e3f9d2"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const storage = firebase.storage();

        // Global variables
        let transactions = [];
        let tags = [];
        let accounts = [];
        let budgets = [];
        let selectedDate = new Date();
        let charts = {};
        let currencySymbol = '₹';
        let defaultAccountId = '';
        let userId = '';
        let username = '';
        let inlineCalendar = null;
        let currentAccountIndex = 0;
        let nonZeroAccounts = [];
        let touchStartX = 0;
        let touchEndX = 0;
        let transactionToDelete = null;
        let notifications = {
            general: [],
            alert: [],
            achieved: [],
            suggestions: []
        };
        let activeNotificationTab = 'general';
        let calendarInitialized = false;

        // Default data
        const defaultTags = [
            { name: "Groceries", color: "#EF4444" },
            { name: "Transport", color: "#3B82F6" },
            { name: "Food", color: "#F59E0B" },
            { name: "Rent", color: "#8B5CF6" },
            { name: "Utilities", color: "#10B981" },
            { name: "Entertainment", color: "#EC4899" },
            { name: "Salary", color: "#14B8A6" },
            { name: "Healthcare", color: "#F97316" },
            { name: "Shopping", color: "#6366F1" },
            { name: "Education", color: "#84CC16" }
        ];

        const defaultAccounts = [
            { name: "Cash", type: "cash", balance: 0 },
            { name: "Bank Account", type: "bank", balance: 0 },
            { name: "Credit Card", type: "credit", balance: 0 },
            { name: "Savings", type: "savings", balance: 0 }
        ];

        // Helper function to format date to DD/MM/YY
        function formatDateToDDMMYY(date) {
            const d = new Date(date);
            const day = String(d.getDate()).padStart(2, '0');
            const month = String(d.getMonth() + 1).padStart(2, '0');
            const year = String(d.getFullYear()).slice(-2);
            return `${day}/${month}/${year}`;
        }

        // Helper function to parse DD/MM/YY to Date object
        function parseDateFromDDMMYY(dateStr) {
            if (!dateStr) return new Date();
            const parts = dateStr.split('/');
            if (parts.length === 3) {
                const day = parseInt(parts[0], 10);
                const month = parseInt(parts[1], 10) - 1; // Months are 0-indexed
                const year = parseInt(parts[2], 10) + 2000; // Assuming 2000s for YY
                return new Date(year, month, day);
            }
            return new Date();
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', () => {
            checkAuthStatus();
            initializeApp();
            setupEventListeners();
            loadInitialData();
            initializeNotifications();
        });

        function checkAuthStatus() {
            userId = localStorage.getItem('userId');
            username = localStorage.getItem('username');

            if (!userId || !username) {
                // User is not logged in, redirect to login page
                window.location.href = 'index.html';
                return;
            }

            // Update username display
            document.getElementById('profileUsername').textContent = username;
        }

        function initializeApp() {
            // Set current date
            const today = new Date();
            const todayString = formatDateToDDMMYY(today);

            document.getElementById('currentMonth').textContent = today.toLocaleDateString('en-US', {
                month: 'long',
                year: 'numeric'
            });
            document.getElementById('todayDate').textContent = today.toLocaleDateString('en-US', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });

            // Initialize date pickers with DD/MM/YY format
            flatpickr("#transactionDate", {
                dateFormat: "d/m/y",
                defaultDate: today,
                onChange: function (selectedDates) {
                    if (selectedDates.length > 0) {
                        selectedDate = selectedDates[0];
                    }
                }
            });

            flatpickr("#quickDate", {
                dateFormat: "d/m/y",
                defaultDate: today,
                onChange: function (selectedDates) {
                    if (selectedDates.length > 0) {
                        selectedDate = selectedDates[0];
                    }
                }
            });

            // Set default dates in form inputs
            document.getElementById('transactionDate').value = todayString;
            document.getElementById('quickDate').value = todayString;

            // Initialize charts
            initializeCharts();

            // Initialize account carousel
            initializeAccountCarousel();
        }

        function initializeCalendar() {
            // Only initialize if not already initialized
            if (calendarInitialized) return;

            // Create a new calendar instance for the dropdown
            const calendarContainer = document.getElementById('inlineCalendar');

            // Clear any existing calendar
            calendarContainer.innerHTML = '';

            // Initialize the calendar with specific configuration to prevent mobile dropdown
            inlineCalendar = flatpickr(calendarContainer, {
                inline: true,
                dateFormat: "d/m/y",
                defaultDate: selectedDate,
                disableMobile: true,
                static: true,
                allowInput: false,
                clickOpens: false,
                animate: false,
                onChange: (selectedDates) => {
                    if (selectedDates.length > 0) {
                        selectedDate = selectedDates[0];
                        updateTodayView();
                        closeCalendar();
                    }
                },
                onReady: function (selectedDates, dateStr, instance) {
                    // Force the calendar to display as inline on all devices
                    const calendar = instance.calendarContainer;

                    // Remove all mobile-specific classes and styles
                    calendar.classList.remove('flatpickr-mobile');
                    calendar.classList.add('inline');

                    // Force desktop view styling
                    calendar.style.position = 'static';
                    calendar.style.top = 'auto';
                    calendar.style.left = 'auto';
                    calendar.style.right = 'auto';
                    calendar.style.bottom = 'auto';
                    calendar.style.transform = 'none';
                    calendar.style.width = '100%';
                    calendar.style.height = 'auto';
                    calendar.style.maxWidth = '300px';
                    calendar.style.maxHeight = '400px';
                    calendar.style.overflow = 'visible';
                    calendar.style.boxShadow = 'none';
                    calendar.style.border = 'none';
                    calendar.style.background = 'transparent';
                    calendar.style.margin = '0';
                    calendar.style.padding = '0';

                    // Ensure proper calendar structure
                    const months = calendar.querySelector('.flatpickr-months');
                    if (months) {
                        months.style.position = 'static';
                        months.style.display = 'block';
                    }

                    const days = calendar.querySelector('.flatpickr-days');
                    if (days) {
                        days.style.position = 'static';
                        days.style.display = 'block';
                        days.style.width = '100%';
                        days.style.overflow = 'visible';
                    }

                    const dayContainer = calendar.querySelector('.dayContainer');
                    if (dayContainer) {
                        dayContainer.style.width = '100%';
                        dayContainer.style.minWidth = '100%';
                        dayContainer.style.maxWidth = '100%';
                        dayContainer.style.position = 'static';
                        dayContainer.style.display = 'grid';
                        dayContainer.style.gridTemplateColumns = 'repeat(7, 1fr)';
                    }

                    // Force all days to be visible
                    const allDays = calendar.querySelectorAll('.flatpickr-day');
                    allDays.forEach(day => {
                        day.style.display = 'inline-block';
                        day.style.position = 'static';
                        day.style.visibility = 'visible';
                    });
                }
            });

            calendarInitialized = true;
        }

        function destroyCalendar() {
            if (inlineCalendar && calendarInitialized) {
                inlineCalendar.destroy();
                inlineCalendar = null;
                calendarInitialized = false;
            }
        }

        function initializeAccountCarousel() {
            const carousel = document.getElementById('accountCarousel');
            const controls = document.getElementById('accountControls');

            // Add touch event listeners for mobile swipe
            carousel.addEventListener('touchstart', handleTouchStart, { passive: true });
            carousel.addEventListener('touchend', handleTouchEnd, { passive: true });

            // Add navigation button for desktop
            document.getElementById('nextAccountBtn').addEventListener('click', nextAccount);
        }

        function handleTouchStart(e) {
            touchStartX = e.changedTouches[0].screenX;
        }

        function handleTouchEnd(e) {
            touchEndX = e.changedTouches[0].screenX;
            handleSwipeGesture();
        }

        function handleSwipeGesture() {
            if (touchEndX < touchStartX - 50) {
                // Swipe left - next account
                nextAccount();
            }
            if (touchEndX > touchStartX + 50) {
                // Swipe right - previous account
                prevAccount();
            }
        }

        function nextAccount() {
            if (nonZeroAccounts.length > 0) {
                currentAccountIndex = (currentAccountIndex + 1) % nonZeroAccounts.length;
                updateAccountCarousel();
            }
        }

        function prevAccount() {
            if (nonZeroAccounts.length > 0) {
                currentAccountIndex = (currentAccountIndex - 1 + nonZeroAccounts.length) % nonZeroAccounts.length;
                updateAccountCarousel();
            }
        }

        function updateAccountCarousel() {
            const carousel = document.getElementById('accountCarousel');
            const controls = document.getElementById('accountControls');

            // Update carousel position
            carousel.style.transform = `translateX(-${currentAccountIndex * 100}%)`;

            // Update dots
            controls.innerHTML = '';
            nonZeroAccounts.forEach((account, index) => {
                const dot = document.createElement('div');
                dot.className = `account-dot ${index === currentAccountIndex ? 'active' : ''}`;
                dot.addEventListener('click', () => {
                    currentAccountIndex = index;
                    updateAccountCarousel();
                });
                controls.appendChild(dot);
            });
        }

        function setupEventListeners() {
            // Quick add toggle buttons
            document.getElementById('quickExpenseBtn').addEventListener('click', () => {
                setQuickTransactionType('expense');
            });

            document.getElementById('quickIncomeBtn').addEventListener('click', () => {
                setQuickTransactionType('income');
            });

            // Quick add
            document.getElementById('quickAddBtn').addEventListener('click', handleQuickAdd);

            // Add transaction button
            document.getElementById('addTransactionBtn').addEventListener('click', () => {
                // Set the date in the form to the currently selected date
                document.getElementById('transactionDate').value = formatDateToDDMMYY(selectedDate);
                document.getElementById('transactionModal').classList.add('active');
            });

            // Transaction modal
            document.getElementById('closeTransactionModal').addEventListener('click', () => {
                document.getElementById('transactionModal').classList.remove('active');
            });

            document.getElementById('cancelTransaction').addEventListener('click', () => {
                document.getElementById('transactionModal').classList.remove('active');
            });

            document.getElementById('transactionForm').addEventListener('submit', handleTransactionSubmit);

            // Transaction type buttons
            document.getElementById('expenseTypeBtn').addEventListener('click', () => {
                setTransactionType('expense');
            });

            document.getElementById('incomeTypeBtn').addEventListener('click', () => {
                setTransactionType('income');
            });

            // Today button
            document.getElementById('todayBtn').addEventListener('click', () => {
                selectedDate = new Date();
                updateTodayView();
            });

            // Date picker button - ONLY open when clicking the button
            document.getElementById('datePickerBtn').addEventListener('click', (e) => {
                e.stopPropagation();
                const dropdown = document.getElementById('calendarDropdown');
                const isActive = dropdown.classList.contains('active');

                // Close dropdown if it's already open
                if (isActive) {
                    dropdown.classList.remove('active');
                    return;
                }

                // Open dropdown
                dropdown.classList.add('active');

                // Initialize calendar only when opening the dropdown
                initializeCalendar();
                inlineCalendar.setDate(selectedDate);
            });

            // Close calendar when clicking outside
            document.addEventListener('click', (e) => {
                const datePickerBtn = document.getElementById('datePickerBtn');
                const calendarDropdown = document.getElementById('calendarDropdown');

                // Only close if clicking outside both the button and the dropdown
                if (!datePickerBtn.contains(e.target) && !calendarDropdown.contains(e.target)) {
                    calendarDropdown.classList.remove('active');
                    // Destroy calendar when closing dropdown to prevent date changes
                    destroyCalendar();
                }
            });

            // Prevent calendar dropdown from closing when clicking inside it
            document.getElementById('calendarDropdown').addEventListener('click', (e) => {
                e.stopPropagation();
            });

            // Export and backup
            document.getElementById('exportBtn').addEventListener('click', handleExport);
            document.getElementById('backupBtn').addEventListener('click', handleBackup);

            // Profile dropdown click
            const profileDropdown = document.querySelector('.profile-dropdown');
            const profileMenu = document.getElementById('profileMenu');

            profileDropdown.addEventListener('click', (e) => {
                e.stopPropagation();
                toggleProfileMenu();
            });

            // Close dropdown when clicking outside
            document.addEventListener('click', (e) => {
                const profileDropdown = document.querySelector('.profile-dropdown');
                const profileMenu = document.getElementById('profileMenu');

                if (!profileDropdown.contains(e.target) && !profileMenu.contains(e.target)) {
                    profileMenu.classList.remove('active');
                }
            });

            // Delete confirmation modal
            document.getElementById('confirmDelete').addEventListener('click', () => {
                if (transactionToDelete) {
                    db.ref(`users/${userId}/data/transactions/${transactionToDelete}`).remove()
                        .then(() => {
                            showNotification('success', 'Transaction Deleted', 'The transaction has been removed');
                            document.getElementById('deleteModal').classList.remove('active');
                            transactionToDelete = null;
                        })
                        .catch((error) => {
                            showNotification('error', 'Error', error.message);
                            document.getElementById('deleteModal').classList.remove('active');
                            transactionToDelete = null;
                        });
                }
            });

            document.getElementById('cancelDelete').addEventListener('click', () => {
                document.getElementById('deleteModal').classList.remove('active');
                transactionToDelete = null;
            });

            // Notification tabs
            document.querySelectorAll('.notification-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    const type = tab.getAttribute('data-type');
                    setActiveNotificationTab(type);
                });
            });
        }

        // Close calendar function
        function closeCalendar() {
            document.getElementById('calendarDropdown').classList.remove('active');
            // Destroy calendar when closing dropdown to prevent date changes
            destroyCalendar();
        }

        function loadInitialData() {
            // Load data from Firebase
            db.ref(`users/${userId}/data`).once('value')
                .then((snapshot) => {
                    const data = snapshot.val() || {};

                    // Load preferences
                    if (data.preferences) {
                        currencySymbol = data.preferences.currency === 'USD' ? '$' :
                            data.preferences.currency === 'EUR' ? '€' :
                                data.preferences.currency === 'GBP' ? '£' :
                                    data.preferences.currency === 'JPY' ? '¥' : '₹';
                        defaultAccountId = data.preferences.defaultAccount || '';
                    }

                    // Load tags
                    if (data.tags) {
                        tags = Object.keys(data.tags).map(id => ({ id, ...data.tags[id] }));
                    } else {
                        createDefaultTags();
                    }

                    // Load accounts
                    if (data.accounts) {
                        accounts = Object.keys(data.accounts).map(id => ({ id, ...data.accounts[id] }));
                    } else {
                        createDefaultAccounts();
                    }

                    // Load transactions
                    if (data.transactions) {
                        transactions = Object.keys(data.transactions).map(id => ({ id, ...data.transactions[id] }));
                        transactions.sort((a, b) => b.timestamp - a.timestamp);
                    }

                    // Load budgets
                    if (data.budgets) {
                        budgets = Object.keys(data.budgets).map(id => ({ id, ...data.budgets[id] }));
                    }

                    // Update UI
                    populateSelects();
                    updateDashboard();
                    renderAllViews();
                    updateAccountView();

                    // Set up real-time listeners
                    setupRealtimeListeners();
                })
                .catch((error) => {
                    console.error('Error loading data:', error);
                    showNotification('error', 'Error', 'Failed to load data');
                });
        }

        function setupRealtimeListeners() {
            // Listen for transactions changes
            db.ref(`users/${userId}/data/transactions`).on('value', (snapshot) => {
                const data = snapshot.val() || {};
                transactions = Object.keys(data).map(id => ({ id, ...data[id] }));
                transactions.sort((a, b) => b.timestamp - a.timestamp);

                updateDashboard();
                renderAllViews();
                updateAccountView();
            });

            // Listen for tags changes
            db.ref(`users/${userId}/data/tags`).on('value', (snapshot) => {
                const data = snapshot.val() || {};
                tags = Object.keys(data).map(id => ({ id, ...data[id] }));
                populateSelects();
            });

            // Listen for accounts changes
            db.ref(`users/${userId}/data/accounts`).on('value', (snapshot) => {
                const data = snapshot.val() || {};
                accounts = Object.keys(data).map(id => ({ id, ...data.accounts[id] }));
                populateSelects();
                updateAccountView();
            });

            // Listen for budgets changes
            db.ref(`users/${userId}/data/budgets`).on('value', (snapshot) => {
                const data = snapshot.val() || {};
                budgets = Object.keys(data).map(id => ({ id, ...data.budgets[id] }));
            });
        }

        function createDefaultTags() {
            const updates = {};
            defaultTags.forEach((tag) => {
                const tagId = db.ref().child(`users/${userId}/data/tags`).push().key;
                updates[`users/${userId}/data/tags/${tagId}`] = {
                    name: tag.name,
                    color: tag.color,
                    createdAt: new Date().getTime(),
                    usageCount: 0
                };
            });

            db.ref().update(updates);
        }

        function createDefaultAccounts() {
            const updates = {};
            defaultAccounts.forEach((account) => {
                const accountId = db.ref().child(`users/${userId}/data/accounts`).push().key;
                updates[`users/${userId}/data/accounts/${accountId}`] = {
                    name: account.name,
                    type: account.type,
                    balance: account.balance,
                    createdAt: new Date().getTime()
                };
            });

            db.ref().update(updates);
        }

        function populateSelects() {
            // Populate tag selects
            const tagSelects = ['quickTag', 'transactionTag'];
            tagSelects.forEach(selectId => {
                const select = document.getElementById(selectId);
                const currentValue = select.value;

                select.innerHTML = '<option value="">Select Category</option>';

                tags.forEach(tag => {
                    const option = document.createElement('option');
                    option.value = tag.id;
                    option.textContent = tag.name;
                    option.style.color = tag.color;
                    select.appendChild(option);
                });

                if (currentValue) select.value = currentValue;
            });

            // Populate account selects
            const accountSelects = ['quickAccount', 'transactionAccount'];
            accountSelects.forEach(selectId => {
                const select = document.getElementById(selectId);
                const currentValue = select.value;

                select.innerHTML = '<option value="">Select Account</option>';

                accounts.forEach(account => {
                    const option = document.createElement('option');
                    option.value = account.id;
                    option.textContent = account.name;
                    select.appendChild(option);
                });

                // Set default account if available
                if (defaultAccountId && !currentValue) {
                    select.value = defaultAccountId;
                } else if (currentValue) {
                    select.value = currentValue;
                }
            });
        }

        function updateDashboard() {
            // Calculate today's transactions
            const today = new Date(selectedDate);
            today.setHours(0, 0, 0, 0);
            const tomorrow = new Date(today);
            tomorrow.setDate(tomorrow.getDate() + 1);

            const todayTransactions = transactions.filter(tx =>
                tx.timestamp >= today.getTime() && tx.timestamp < tomorrow.getTime()
            );

            let todayIncome = 0;
            let todayExpense = 0;

            todayTransactions.forEach(tx => {
                if (tx.type === 'income') {
                    todayIncome += tx.amount;
                } else {
                    todayExpense += tx.amount;
                }
            });

            // Calculate current balance
            let balance = 0;
            transactions.forEach(tx => {
                if (tx.type === 'income') {
                    balance += tx.amount;
                } else {
                    balance -= tx.amount;
                }
            });

            // Calculate monthly total
            const monthStart = new Date(today.getFullYear(), today.getMonth(), 1);
            monthStart.setHours(0, 0, 0, 0);
            const monthEnd = new Date(today.getFullYear(), today.getMonth() + 1, 0);
            monthEnd.setHours(23, 59, 59, 999);

            let monthlyTotal = 0;
            transactions.forEach(tx => {
                if (tx.timestamp >= monthStart.getTime() && tx.timestamp <= monthEnd.getTime()) {
                    if (tx.type === 'income') {
                        monthlyTotal += tx.amount;
                    } else {
                        monthlyTotal -= tx.amount;
                    }
                }
            });

            // Update UI
            document.getElementById('todayIncome').textContent = `${currencySymbol}${todayIncome.toFixed(2)}`;
            document.getElementById('todayExpense').textContent = `${currencySymbol}${todayExpense.toFixed(2)}`;
            document.getElementById('monthlyTotal').textContent = `${currencySymbol}${monthlyTotal.toFixed(2)}`;

            // Update transaction counts
            const incomeCount = todayTransactions.filter(tx => tx.type === 'income').length;
            const expenseCount = todayTransactions.filter(tx => tx.type === 'expense').length;

            document.querySelector('#todayIncome').nextElementSibling.textContent = `+${incomeCount} transactions`;
            document.querySelector('#todayExpense').nextElementSibling.textContent = `-${expenseCount} transactions`;

            // Update section title and labels based on selected date
            const isToday = isDateToday(selectedDate);
            if (isToday) {
                document.getElementById('transactionSectionTitle').textContent = "Today's Transactions";
                document.getElementById('incomeLabel').textContent = "Today's Income";
                document.getElementById('expenseLabel').textContent = "Today's Expenses";
            } else {
                const dateStr = selectedDate.toLocaleDateString('en-US', {
                    month: 'short',
                    day: 'numeric',
                    year: 'numeric'
                });
                document.getElementById('transactionSectionTitle').textContent = `Transactions on`;
                document.getElementById('incomeLabel').textContent = "Income";
                document.getElementById('expenseLabel').textContent = "Expenses";
            }

            // Render today's transactions
            renderTodayTransactions(todayTransactions);

            // Render category pie chart
            renderCategoryPieChart();

            // Update charts
            updateCharts();

            // Update monthly overview
            updateMonthlyOverview();
        }

        function updateAccountView() {
            // Calculate account balances
            const accountBalances = {};

            // Initialize all accounts with 0 balance
            accounts.forEach(account => {
                accountBalances[account.id] = {
                    ...account,
                    balance: 0
                };
            });

            // Calculate balance for each account based on transactions
            transactions.forEach(tx => {
                if (accountBalances[tx.accountId]) {
                    if (tx.type === 'income') {
                        accountBalances[tx.accountId].balance += tx.amount;
                    } else {
                        accountBalances[tx.accountId].balance -= tx.amount;
                    }
                }
            });

            // Filter accounts with non-zero balance
            nonZeroAccounts = Object.values(accountBalances).filter(account => account.balance !== 0);

            // If no accounts with non-zero balance, show all accounts
            if (nonZeroAccounts.length === 0) {
                nonZeroAccounts = Object.values(accountBalances);
            }

            // Sort accounts to put default account first
            if (defaultAccountId) {
                const defaultAccountIndex = nonZeroAccounts.findIndex(account => account.id === defaultAccountId);
                if (defaultAccountIndex !== -1) {
                    const defaultAccount = nonZeroAccounts.splice(defaultAccountIndex, 1)[0];
                    nonZeroAccounts.unshift(defaultAccount);
                    currentAccountIndex = 0;
                }
            }

            // Reset current index if it's out of bounds
            if (currentAccountIndex >= nonZeroAccounts.length) {
                currentAccountIndex = 0;
            }

            // Update account carousel
            updateAccountCarousel();
        }

        function updateAccountCarousel() {
            const carousel = document.getElementById('accountCarousel');
            const controls = document.getElementById('accountControls');

            // Clear existing content
            carousel.innerHTML = '';
            controls.innerHTML = '';

            // Create slides for each account
            nonZeroAccounts.forEach((account, index) => {
                const slide = document.createElement('div');
                slide.className = 'account-slide';
                slide.innerHTML = `
                    <div class="relative z-10">
                        <p class="text-white/80 text-sm mb-1">${account.name}</p>
                        <p class="text-3xl font-bold">${currencySymbol}${account.balance.toFixed(2)}</p>
                        <p class="text-white/60 text-xs mt-2">${account.type}</p>
                    </div>
                `;
                carousel.appendChild(slide);

                // Create dot indicator
                const dot = document.createElement('div');
                dot.className = `account-dot ${index === currentAccountIndex ? 'active' : ''}`;
                dot.addEventListener('click', () => {
                    currentAccountIndex = index;
                    updateAccountCarousel();
                });
                controls.appendChild(dot);
            });

            // Set carousel position
            carousel.style.transform = `translateX(-${currentAccountIndex * 100}%)`;
        }

        function isDateToday(date) {
            const today = new Date();
            return date.getDate() === today.getDate() &&
                date.getMonth() === today.getMonth() &&
                date.getFullYear() === today.getFullYear();
        }

        function updateTodayView() {
            // Update today's date display
            document.getElementById('todayDate').textContent = selectedDate.toLocaleDateString('en-US', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });

            // Update quick add date
            document.getElementById('quickDate').value = formatDateToDDMMYY(selectedDate);

            // Update dashboard
            updateDashboard();
        }

        function renderTodayTransactions(todayTransactions) {
            const container = document.getElementById('todayTransactions');

            if (todayTransactions.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-8">No transactions for this day</p>';
                return;
            }

            container.innerHTML = '';

            todayTransactions.forEach(tx => {
                const tag = tags.find(t => t.id === tx.tagId);
                const account = accounts.find(a => a.id === tx.accountId);

                const item = document.createElement('div');
                item.className = `transaction-item ${tx.type}`;
                item.innerHTML = `
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-full flex items-center justify-center" style="background-color: ${tag?.color || '#6B7280'}20">
                            <i class="${tx.type === 'income' ? 'ri-arrow-down-line text-green-600' : 'ri-arrow-up-line text-red-600'}"></i>
                        </div>
                        <div>
                            <div class="font-medium">${tag?.name || 'Unknown'}</div>
                            <div class="text-sm text-gray-500">${tx.note || 'No note'} • ${account?.name || 'Unknown'}</div>
                        </div>
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="font-bold ${tx.type === 'income' ? 'text-green-600' : 'text-red-600'}">
                            ${tx.type === 'income' ? '+' : '-'}${currencySymbol}${tx.amount.toFixed(2)}
                        </span>
                        <button class="text-gray-400 hover:text-gray-600" onclick="editTransaction('${tx.id}')">
                            <i class="ri-edit-line"></i>
                        </button>
                        <button class="text-gray-400 hover:text-red-600" onclick="confirmDeleteTransaction('${tx.id}')">
                            <i class="ri-delete-bin-line"></i>
                        </button>
                    </div>
                `;
                container.appendChild(item);
            });
        }

        function renderCategoryPieChart() {
            // Calculate category totals for today
            const today = new Date(selectedDate);
            today.setHours(0, 0, 0, 0);
            const tomorrow = new Date(today);
            tomorrow.setDate(tomorrow.getDate() + 1);

            const todayTransactions = transactions.filter(tx =>
                tx.timestamp >= today.getTime() && tx.timestamp < tomorrow.getTime() && tx.type === 'expense'
            );

            const categoryTotals = {};
            todayTransactions.forEach(tx => {
                const tag = tags.find(t => t.id === tx.tagId);
                const categoryName = tag?.name || 'Unknown';

                if (!categoryTotals[categoryName]) {
                    categoryTotals[categoryName] = { amount: 0, color: tag?.color || '#6B7280' };
                }

                categoryTotals[categoryName].amount += tx.amount;
            });

            // Sort by amount
            const sortedCategories = Object.entries(categoryTotals)
                .sort((a, b) => b[1].amount - a[1].amount)
                .slice(0, 5);

            // Update pie chart
            const ctx = document.getElementById('categoryPieChart').getContext('2d');

            if (charts.categoryPie) {
                charts.categoryPie.destroy();
            }

            charts.categoryPie = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: sortedCategories.map(c => c[0]),
                    datasets: [{
                        data: sortedCategories.map(c => c[1].amount),
                        backgroundColor: sortedCategories.map(c => c[1].color),
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });

            // Update legend
            const legendContainer = document.getElementById('categoryLegend');
            legendContainer.innerHTML = '';

            sortedCategories.forEach(([name, data]) => {
                const legendItem = document.createElement('div');
                legendItem.className = 'flex items-center justify-between';
                legendItem.innerHTML = `
                    <div class="flex items-center gap-2">
                        <div class="w-3 h-3 rounded-full" style="background-color: ${data.color}"></div>
                        <span class="text-sm">${name}</span>
                    </div>
                    <span class="text-sm font-medium">${currencySymbol}${data.amount.toFixed(2)}</span>
                `;
                legendContainer.appendChild(legendItem);
            });
        }

        function initializeCharts() {
            // Monthly chart
            const monthlyCtx = document.getElementById('monthlyChart').getContext('2d');
            charts.monthly = new Chart(monthlyCtx, {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: [
                        {
                            label: 'Income',
                            data: [],
                            backgroundColor: '#10B981'
                        },
                        {
                            label: 'Expense',
                            data: [],
                            backgroundColor: '#EF4444'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: (value) => currencySymbol + value
                            }
                        }
                    }
                }
            });
        }

        function updateCharts() {
            // Update monthly chart
            const today = new Date(selectedDate);
            const monthStart = new Date(today.getFullYear(), today.getMonth(), 1);
            monthStart.setHours(0, 0, 0, 0);
            const monthEnd = new Date(today.getFullYear(), today.getMonth() + 1, 0);
            monthEnd.setHours(23, 59, 59, 999);

            // Calculate daily totals
            const dailyData = {};
            const monthlyTransactions = transactions.filter(tx =>
                tx.timestamp >= monthStart.getTime() && tx.timestamp <= monthEnd.getTime()
            );

            monthlyTransactions.forEach(tx => {
                const date = new Date(tx.timestamp);
                const dateKey = date.toISOString().slice(0, 10);

                if (!dailyData[dateKey]) {
                    dailyData[dateKey] = { income: 0, expense: 0 };
                }

                if (tx.type === 'income') {
                    dailyData[dateKey].income += tx.amount;
                } else {
                    dailyData[dateKey].expense += tx.amount;
                }
            });

            const labels = Object.keys(dailyData).sort();
            const incomeData = labels.map(label => dailyData[label].income);
            const expenseData = labels.map(label => dailyData[label].expense);

            charts.monthly.data.labels = labels;
            charts.monthly.data.datasets[0].data = incomeData;
            charts.monthly.data.datasets[1].data = expenseData;
            charts.monthly.update();
        }

        function updateMonthlyOverview() {
            const today = new Date(selectedDate);
            const monthStart = new Date(today.getFullYear(), today.getMonth(), 1);
            monthStart.setHours(0, 0, 0, 0);
            const monthEnd = new Date(today.getFullYear(), today.getMonth() + 1, 0);
            monthEnd.setHours(23, 59, 59, 999);

            let monthlyIncome = 0;
            let monthlyExpense = 0;

            const monthlyTransactions = transactions.filter(tx =>
                tx.timestamp >= monthStart.getTime() && tx.timestamp <= monthEnd.getTime()
            );

            monthlyTransactions.forEach(tx => {
                if (tx.type === 'income') {
                    monthlyIncome += tx.amount;
                } else {
                    monthlyExpense += tx.amount;
                }
            });

            // Update UI
            document.getElementById('monthlyIncome').textContent = `${currencySymbol}${monthlyIncome.toFixed(2)}`;
            document.getElementById('monthlyExpense').textContent = `${currencySymbol}${monthlyExpense.toFixed(2)}`;
            document.getElementById('monthlyNet').textContent = `${currencySymbol}${(monthlyIncome - monthlyExpense).toFixed(2)}`;

            // Render monthly transactions
            renderMonthlyTransactions(monthlyTransactions);
        }

        function renderMonthlyTransactions(monthlyTransactions) {
            const container = document.getElementById('monthlyTransactions');
            container.innerHTML = '';

            if (monthlyTransactions.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-4">No transactions this month</p>';
                return;
            }

            monthlyTransactions.slice(0, 10).forEach(tx => {
                const tag = tags.find(t => t.id === tx.tagId);
                const account = accounts.find(a => a.id === tx.accountId);
                const date = new Date(tx.timestamp);

                const item = document.createElement('div');
                item.className = `transaction-item ${tx.type}`;
                item.innerHTML = `
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-full flex items-center justify-center" style="background-color: ${tag?.color || '#6B7280'}20">
                            <i class="${tx.type === 'income' ? 'ri-arrow-down-line text-green-600' : 'ri-arrow-up-line text-red-600'}"></i>
                        </div>
                        <div>
                            <div class="font-medium">${tag?.name || 'Unknown'}</div>
                            <div class="text-sm text-gray-500">${date.toLocaleDateString()} • ${tx.note || 'No note'}</div>
                        </div>
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="font-bold ${tx.type === 'income' ? 'text-green-600' : 'text-red-600'}">
                            ${tx.type === 'income' ? '+' : '-'}${currencySymbol}${tx.amount.toFixed(2)}
                        </span>
                        <button class="text-gray-400 hover:text-gray-600" onclick="editTransaction('${tx.id}')">
                            <i class="ri-edit-line"></i>
                        </button>
                        <button class="text-gray-400 hover:text-red-600" onclick="confirmDeleteTransaction('${tx.id}')">
                            <i class="ri-delete-bin-line"></i>
                        </button>
                    </div>
                `;
                container.appendChild(item);
            });
        }

        function renderAllViews() {
            updateMonthlyOverview();
        }

        function setQuickTransactionType(type) {
            const expenseBtn = document.getElementById('quickExpenseBtn');
            const incomeBtn = document.getElementById('quickIncomeBtn');

            if (type === 'income') {
                incomeBtn.classList.add('active');
                expenseBtn.classList.remove('active');
            } else {
                expenseBtn.classList.add('active');
                incomeBtn.classList.remove('active');
            }
        }

        function setTransactionType(type) {
            const modalContent = document.querySelector('#transactionModal .modal-content');
            const expenseBtn = document.getElementById('expenseTypeBtn');
            const incomeBtn = document.getElementById('incomeTypeBtn');

            document.getElementById('transactionType').value = type;

            if (type === 'income') {
                incomeBtn.classList.add('active');
                expenseBtn.classList.remove('active');
                modalContent.classList.remove('expense');
                modalContent.classList.add('income');
            } else {
                expenseBtn.classList.add('active');
                incomeBtn.classList.remove('active');
                modalContent.classList.remove('income');
                modalContent.classList.add('expense');
            }
        }

        function handleQuickAdd() {
            const amount = parseFloat(document.getElementById('quickAmount').value);
            const type = document.getElementById('quickExpenseBtn').classList.contains('active') ? 'expense' : 'income';
            const tagId = document.getElementById('quickTag').value;
            const accountId = document.getElementById('quickAccount').value || defaultAccountId;
            const dateStr = document.getElementById('quickDate').value;
            const note = document.getElementById('quickNote').value;

            if (!amount || !tagId || !accountId || !dateStr) {
                showNotification('error', 'Missing Information', 'Please fill all required fields');
                return;
            }

            // Parse date from DD/MM/YY format
            const date = parseDateFromDDMMYY(dateStr);

            const transaction = {
                type,
                amount,
                tagId,
                accountId,
                note,
                timestamp: date.getTime()
            };

            saveTransaction(transaction);

            // Reset form
            document.getElementById('quickAmount').value = '';
            document.getElementById('quickTag').value = '';
            document.getElementById('quickAccount').value = defaultAccountId;
            document.getElementById('quickNote').value = '';
        }

        function handleTransactionSubmit(e) {
            e.preventDefault();

            const type = document.getElementById('transactionType').value;
            const amount = parseFloat(document.getElementById('transactionAmount').value);
            const dateStr = document.getElementById('transactionDate').value;
            const tagId = document.getElementById('transactionTag').value;
            const accountId = document.getElementById('transactionAccount').value || defaultAccountId;
            const note = document.getElementById('transactionNote').value;

            if (!amount || !dateStr || !tagId || !accountId) {
                showNotification('error', 'Missing Information', 'Please fill all required fields');
                return;
            }

            // Parse date from DD/MM/YY format
            const date = parseDateFromDDMMYY(dateStr);

            const transaction = {
                type,
                amount,
                tagId,
                accountId,
                note,
                timestamp: date.getTime()
            };

            saveTransaction(transaction);

            // Reset form and close modal
            document.getElementById('transactionForm').reset();
            document.getElementById('transactionModal').classList.remove('active');
        }

        function saveTransaction(transaction) {
            const transactionId = db.ref().child(`users/${userId}/data/transactions`).push().key;

            db.ref(`users/${userId}/data/transactions/${transactionId}`).set(transaction)
                .then(() => {
                    // Update tag usage count
                    const tag = tags.find(t => t.id === transaction.tagId);
                    if (tag) {
                        db.ref(`users/${userId}/data/tags/${transaction.tagId}/usageCount`).set((tag.usageCount || 0) + 1);
                    }

                    showNotification('success', 'Transaction Added', 'Your transaction has been saved');
                })
                .catch((error) => {
                    showNotification('error', 'Error', error.message);
                });
        }

        function editTransaction(transactionId) {
            const transaction = transactions.find(tx => tx.id === transactionId);
            if (!transaction) return;

            // Populate form with transaction data
            document.getElementById('transactionType').value = transaction.type;
            document.getElementById('transactionAmount').value = transaction.amount;

            const date = new Date(transaction.timestamp);
            document.getElementById('transactionDate').value = formatDateToDDMMYY(date);

            document.getElementById('transactionTag').value = transaction.tagId;
            document.getElementById('transactionAccount').value = transaction.accountId;
            document.getElementById('transactionNote').value = transaction.note || '';

            // Update type buttons
            setTransactionType(transaction.type);

            // Show modal
            document.getElementById('transactionModal').classList.add('active');

            // Store transaction ID for update
            document.getElementById('transactionModal').dataset.transactionId = transactionId;
        }

        function confirmDeleteTransaction(transactionId) {
            transactionToDelete = transactionId;
            document.getElementById('deleteModal').classList.add('active');
        }

        function deleteTransaction(transactionId) {
            if (!confirm('Are you sure you want to delete this transaction?')) return;

            db.ref(`users/${userId}/data/transactions/${transactionId}`).remove()
                .then(() => {
                    showNotification('success', 'Transaction Deleted', 'The transaction has been removed');
                })
                .catch((error) => {
                    showNotification('error', 'Error', error.message);
                });
        }

        function handleExport() {
            const data = {
                transactions,
                tags,
                accounts,
                budgets,
                preferences: {
                    currency: currencySymbol === '$' ? 'USD' :
                        currencySymbol === '€' ? 'EUR' :
                            currencySymbol === '£' ? 'GBP' :
                                currencySymbol === '¥' ? '¥' : '₹',
                    defaultAccount: defaultAccountId
                },
                exportedAt: new Date().toISOString()
            };

            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `budget-planner-backup-${new Date().toISOString().slice(0, 10)}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            showNotification('success', 'Export Successful', 'Your data has been exported');
        }

        function handleBackup() {
            const data = {
                transactions,
                tags,
                accounts,
                budgets,
                preferences: {
                    currency: currencySymbol === '$' ? 'USD' :
                        currencySymbol === '€' ? 'EUR' :
                            currencySymbol === '£' ? 'GBP' :
                                currencySymbol === '¥' ? '¥' : '₹',
                    defaultAccount: defaultAccountId
                },
                backedUpAt: new Date().toISOString()
            };

            // Upload to Firebase Storage
            const storageRef = storage.ref();
            const backupRef = storage.ref(`backups/${userId}/${new Date().getTime()}.json`);

            backupRef.putString(JSON.stringify(data))
                .then(() => {
                    // Update last backup time
                    db.ref(`users/${userId}/meta/lastBackupTime`).set(new Date().getTime());

                    showNotification('success', 'Backup Successful', 'Your data has been backed up to the cloud');
                })
                .catch((error) => {
                    showNotification('error', 'Error', error.message);
                });
        }

        function toggleProfileMenu() {
            const profileMenu = document.getElementById('profileMenu');
            profileMenu.classList.toggle('active');
        }

        function navigateTo(page) {
            window.location.href = page;
        }

        function logout() {
            localStorage.removeItem('userId');
            localStorage.removeItem('username');
            window.location.href = 'index.html';
        }

        function showNotification(type, title, message) {
            const notificationEl = document.getElementById('notification');
            const iconEl = document.getElementById('notificationIcon');
            const titleEl = document.getElementById('notificationTitle');
            const messageEl = document.getElementById('notificationMessage');

            // Set notification type
            notificationEl.className = `notification ${type}`;

            // Set icon
            switch (type) {
                case 'success':
                    iconEl.className = 'ri-check-line text-xl text-green-600';
                    break;
                case 'error':
                    iconEl.className = 'ri-error-warning-line text-xl text-red-600';
                    break;
                case 'info':
                    iconEl.className = 'ri-information-line text-xl text-blue-600';
                    break;
            }

            // Set content
            titleEl.textContent = title;
            messageEl.textContent = message;

            // Show notification
            notificationEl.classList.add('show');

            // Hide after 3 seconds
            setTimeout(() => {
                notificationEl.classList.remove('show');
            }, 3000);
        }

        function toggleMobileMenu() {
            const mobileMenu = document.getElementById('mobileMenu');
            mobileMenu.classList.toggle('active');
        }

        // Close mobile menu when clicking outside
        document.addEventListener('click', (e) => {
            const mobileMenu = document.getElementById('mobileMenu');
            const mobileMenuContent = document.querySelector('.mobile-menu-content');
            const hamburgerBtn = document.querySelector('.md\\:hidden');

            if (!mobileMenuContent.contains(e.target) && !hamburgerBtn.contains(e.target)) {
                mobileMenu.classList.remove('active');
            }
        });

        // Notification System
        function initializeNotifications() {
            // Set up notification tabs
            setActiveNotificationTab('general');

            // Add some sample notifications for demonstration
            addNotification('general', 'Welcome to Cashual', 'Your budget planner is ready to use. Start by adding your first transaction!');
            addNotification('general', 'Tip of the Day', 'Try setting up budgets for different categories to track your spending better.');
        }

        function setActiveNotificationTab(type) {
            activeNotificationTab = type;

            // Update tab UI
            document.querySelectorAll('.notification-tab').forEach(tab => {
                if (tab.getAttribute('data-type') === type) {
                    tab.classList.add('active');
                } else {
                    tab.classList.remove('active');
                }
            });

            // Update notification content
            renderNotifications(type);
        }

        function renderNotifications(type) {
            const content = document.getElementById('notificationContent');
            const typeNotifications = notifications[type] || [];

            if (typeNotifications.length === 0) {
                content.innerHTML = `
                    <div class="empty-notification">
                        <i class="ri-notification-off-line text-4xl mb-2"></i>
                        <p>No ${type} notifications yet</p>
                    </div>
                `;
                return;
            }

            content.innerHTML = '';

            typeNotifications.forEach(notification => {
                const item = document.createElement('div');
                item.className = 'notification-item';
                item.innerHTML = `
                    <button class="notification-item-close" onclick="removeNotification('${type}', ${notification.id})">
                        <i class="ri-close-line"></i>
                    </button>
                    <div class="notification-item-title">${notification.title}</div>
                    <div class="notification-item-message">${notification.message}</div>
                    <div class="notification-item-time">${formatTime(notification.timestamp)}</div>
                `;
                content.appendChild(item);
            });
        }

        function removeNotification(type, notificationId) {
            if (notifications[type]) {
                notifications[type] = notifications[type].filter(n => n.id !== notificationId);
                renderNotifications(type);
                updateNotificationTab(type);
            }
        }

        function formatTime(timestamp) {
            const date = new Date(timestamp);
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);

            if (diffMins < 1) return 'Just now';
            if (diffMins < 60) return `${diffMins} minute${diffMins > 1 ? 's' : ''} ago`;

            const diffHours = Math.floor(diffMins / 60);
            if (diffHours < 24) return `${diffHours} hour${diffHours > 1 ? 's' : ''} ago`;

            const diffDays = Math.floor(diffHours / 24);
            if (diffDays < 7) return `${diffDays} day${diffDays > 1 ? 's' : ''} ago`;

            return date.toLocaleDateString();
        }

        function addNotification(type, title, message, isNew = true) {
            if (!notifications[type]) {
                notifications[type] = [];
            }

            const notification = {
                id: Date.now(),
                title,
                message,
                timestamp: new Date().getTime(),
                isNew
            };

            notifications[type].unshift(notification);

            // Update tab background color
            updateNotificationTab(type);

            // Show new notification temporarily
            if (isNew) {
                showNewNotification(notification);
            }

            // If this is the active tab, update the content
            if (activeNotificationTab === type) {
                renderNotifications(type);
            }
        }

        function updateNotificationTab(type) {
            const tab = document.getElementById(`${type}Tab`);
            const count = notifications[type] ? notifications[type].length : 0;

            if (count > 0) {
                tab.classList.add('has-notifications');
            } else {
                tab.classList.remove('has-notifications');
            }
        }

        function showNewNotification(notification) {
            // Create a temporary notification element
            const tempNotification = document.createElement('div');
            tempNotification.className = 'notification show';
            tempNotification.innerHTML = `
                <i class="ri-notification-3-line text-xl text-blue-600"></i>
                <div>
                    <p class="font-medium">${notification.title}</p>
                    <p class="text-sm text-gray-600">${notification.message}</p>
                </div>
            `;

            document.body.appendChild(tempNotification);

            // Remove after 5 seconds
            setTimeout(() => {
                tempNotification.classList.remove('show');
                setTimeout(() => {
                    document.body.removeChild(tempNotification);
                }, 300);
            }, 5000);
        }
    </script>
</body>

</html>
